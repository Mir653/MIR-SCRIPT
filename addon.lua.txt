-- Client Replicating Fly (LocalScript)
-- Press F to toggle

local player = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local flying = false
local speed = 70

local char, hum, hrp
local bv, bg

local function setupChar()
	char = player.Character or player.CharacterAdded:Wait()
	hum = char:WaitForChild("Humanoid")
	hrp = char:WaitForChild("HumanoidRootPart")
end

setupChar()
player.CharacterAdded:Connect(setupChar)

local function startFly()
	if flying then return end
	flying = true

	hum.PlatformStand = true

	bv = Instance.new("BodyVelocity")
	bv.MaxForce = Vector3.new(1e9, 1e9, 1e9)
	bv.Velocity = Vector3.zero
	bv.Parent = hrp

	bg = Instance.new("BodyGyro")
	bg.MaxTorque = Vector3.new(1e9, 1e9, 1e9)
	bg.P = 90000
	bg.CFrame = hrp.CFrame
	bg.Parent = hrp
end

local function stopFly()
	flying = false
	hum.PlatformStand = false

	if bv then bv:Destroy() end
	if bg then bg:Destroy() end
end

UIS.InputBegan:Connect(function(input, gp)
	if gp then return end
	if input.KeyCode == Enum.KeyCode.F then
		if flying then
			stopFly()
		else
			startFly()
		end
	end
end)

RunService.RenderStepped:Connect(function()
	if not flying then return end
	if not hrp then return end

	local cam = workspace.CurrentCamera
	local dir = Vector3.zero

	if UIS:IsKeyDown(Enum.KeyCode.W) then dir += cam.CFrame.LookVector end
	if UIS:IsKeyDown(Enum.KeyCode.S) then dir -= cam.CFrame.LookVector end
	if UIS:IsKeyDown(Enum.KeyCode.A) then dir -= cam.CFrame.RightVector end
	if UIS:IsKeyDown(Enum.KeyCode.D) then dir += cam.CFrame.RightVector end
	if UIS:IsKeyDown(Enum.KeyCode.Space) then dir += cam.CFrame.UpVector end
	if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then dir -= cam.CFrame.UpVector end

	if dir.Magnitude > 0 then
		dir = dir.Unit * speed
	end

	bv.Velocity = dir
	bg.CFrame = cam.CFrame
end)